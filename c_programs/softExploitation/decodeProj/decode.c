#include <stdio.h>
#include <stdlib.h>
#include <string.h>
/*
* USING POINTER ARITHMETIC FOR PRACTICE *
*/
void scanInputType(char *cliInput);
void cutFirstChar(char *cliInput);
long int littleEndianConversion(char *cliInput);

int main(int argc, char **argv)
{
    /*  input | Description
     *   cNM   | c denotes a byte of 2 hex values.
     *   bN    | b denotes big endian 8 hex values
     *   lN    | l denotes little endian 8 hex
     *   Psuedo Algo:
     *      # switch statement -> 3 function split to decode types
     *      # strip off first letter in switch block
     *      #
     */
    if(argc < 2)
    {
        exit(0);
    }
    int i;
    for (i = 1; i < argc; i++)
    {
        char *curStr = *(argv + i);
        char curcur = *curStr;
        // printf("%s %c\n", curStr, *curStr);
        if(curcur != 'c' && curcur != 'l' && curcur != 'b')
        {
            fprintf(stderr, "bad input\n");
        }
        else
        {
            scanInputType(curStr); // argv[i] with & becomes **argv
        }
    }
    return 0;
}

void scanInputType(char *cliInput)
{
    long int leConverted;
    switch (*cliInput)
    { 

    case 'c':

        cutFirstChar(cliInput); // pass by reference
        int val = strtol(cliInput, NULL, 16);
        char asciiValue = (char)val;

        printf("%c",asciiValue);
        break;

    case 'l':
        cutFirstChar(cliInput); // pass by reference
        leConverted = littleEndianConversion(cliInput);
        printf("%ld",leConverted);
        break;

    case 'b':
        cutFirstChar(cliInput); // pass by reference 
        printf("%ld", strtol(cliInput,NULL,16));
        break;
    }
}

void cutFirstChar(char *cliInput) 
{
    int length = strlen(cliInput);
    int idx = 1; 
    int i;
    char *cPtr = cliInput;

    for (i = 0; i < length; i++)
    {
        *(cliInput + i) = *(cPtr + idx);
        idx++;
    }
    (*(cliInput + length - 1)) = '\0'; // add the null terminator
}
// could probaby be faster by buffering 2 chars for swap end up doing 
long int littleEndianConversion(char *cliInput)
{
    char strBuffer[strlen(cliInput) + 1];
    int reverseIdx = (int)strlen(cliInput) - 1;
    strcpy(strBuffer, cliInput);
    char temp = 0;
    int idx = 1;
    int i;

    // reverse string 
    for(i = 0; i < strlen(cliInput); i++)
    {
        *(cliInput + reverseIdx) = *(strBuffer + i);
        reverseIdx--;
    }
    // swap hex digis
    for(i = 0; i < strlen(cliInput); i+=2)
    {
        temp = *(cliInput + i); 
        *(cliInput + i) = *(cliInput + idx);
        *(cliInput + idx) = temp;
        idx+=2;
    }

    return strtol(cliInput,NULL,16);
}